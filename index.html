<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Absensi & Hafalan Santri</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f6f8;
    }

    button.lihat-quran-btn {
  all: unset; /* reset semua style bawaan */
  display: inline-block;
  font-weight: 600;
  font-size: 14px;
  letter-spacing: 0.3px;
  color: #1E88E5;
  padding: 2px 4px;
  cursor: pointer;
  position: relative;
  transition: color 0.00s ease;
}

/* underline animasi halus */
button.lihat-quran-btn::after {
  content: "";
  position: absolute;
  left: 0;
  bottom: -2px;
  width: 0%;
  height: 2px;
  background-color: currentColor;
  transition: width 0.00s ease;
}

button.lihat-quran-btn:hover {
  color: #ffffff;
}

button.lihat-quran-btn:hover::after {
  width: 100%;
}

#santri-table th:first-child,
#santri-table td:first-child {
  position: sticky;
  left: 0;
  background: white;
  z-index: 5;
  border-right: 1px solid #ccc; /* opsional, biar ada garis pembatas */
}

    .password-wrapper {
  position: relative;
  width: 100%;
}

.password-wrapper input {
  width: 100%;
  padding-right: 40px; /* ruang untuk icon üëÅ */
  box-sizing: border-box;
}

.toggle-password {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  user-select: none;
  font-size: 16px;
}

    .password-login-group {
  display: flex;
  align-items: center;
  gap: 8px; /* jarak antara password dan tombol login */
}

.password-login-group button {
  white-space: nowrap; /* biar tulisan "Login" nggak pecah */
}

    #username {
  width: 314px; /* atur lebar sesuai kebutuhan */
  max-width: 100%; /* biar tetap responsif di layar kecil */
  box-sizing: border-box; /* supaya padding ikut hitung lebar */
}


   .modal {
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px; /* Tambahan: agar konten modal tidak nempel di tepi */
  box-sizing: border-box;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 300px; /* Batasi ukuran maksimum di desktop */
  box-sizing: border-box;
}

/* Responsif tambahan (opsional) */
@media (max-width: 400px) {
  .modal-content {
    padding: 15px;
    font-size: 14px;
  }
}

    .login-actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 15px;
}

@media (max-width: 600px) {
  .login-actions {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }

  .login-actions button {
    width: 100%;
  }
}

.dashboard-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.dashboard-header-row {
  display: flex;
  flex-direction: row;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
}

.dashboard-header label {
  font-size: 16px;
}

.dashboard-header select,
.dashboard-header input[type="date"] {
  padding: 8px;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
  min-width: 140px;
}

/* üåê Tambahkan ini untuk mobile */
@media (max-width: 600px) {
  .dashboard-header-row {
    flex-direction: column;
    align-items: stretch;
  }

  .dashboard-header label {
    text-align: left;
    width: 100%;
  }
}
    
    .total-all-juz span {
  font-weight: bold;
  background: #e0f2f1;
  border-radius: 4px;
  padding: 1px 4px;
}
    .container {
      max-width: 1400px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-top: 0px;
    }
    h1, h2 {
      text-align: center;
    }
    form, .dashboard-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      margin-top: 0px;
    }
    input, select, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    button {
      background: #1e88e5;
      color: white;
      cursor: pointer;
      margin: 2px;
    }
    button:hover {
      background: #1565c0;
    }
    .logout-btn {
      background: #e53935;
    }
    .logout-btn:hover {
      background: #b71c1c;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #1e88e5;
      color: white;
    }
    .actions {
      text-align: center;
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .password-group {
      display: flex;
      gap: 5px;
      align-items: center;
    }
    .toggle-btn {
      background: #6c757d;
      font-size: 13px;
      padding: 10px 14px;
    }
    .toggle-btn:hover {
      background: #495057;
    }
    /* Overlay Loading */
    #overlay {
      position: fixed;
      display: none;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    #overlay span {
      background: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 18px;
      color: #333;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    @media (max-width: 768px) {
      .dashboard-header {
        flex-direction: column;
        align-items: stretch;
      }
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      .actions {
        flex-direction: column;
      }
      .password-group {
        flex-direction: row;
      }
    }
  </style>
</head>
<body>
  <div id="overlay"><span>‚è≥ Loading...</span></div>

<div class="container">
  <!-- Halaman Login -->
  <div id="login-card" class="card">
    <h1>Login Pengajar</h1>
    <form id="login-form" onsubmit="event.preventDefault(); login();">
      <input type="text" id="username" placeholder="Username" required />
      <div class="password-group" style="display: flex; align-items: center;">
   <div class="password-wrapper">
    <input type="password" id="password" placeholder="Password" required />
    <span class="toggle-password" onclick="togglePassword()">üëÅ</span>
  </div>
  <button type="submit">Login</button>
</div>

      <div class="login-actions">
        <button type="button" onclick="toggleChangePassword()">Ganti Password</button>
        <button type="button" id="daftar-btn" onclick="daftar()">Daftar Admin</button>
        <button type="button" onclick="munculkanValidasiAdmin()">Daftar User Kelas</button>
        <button type="button" onclick="bukaModalTambahKelas()">Tambah Kelas</button>
      </div>
    </form>


    <div id="modalTambahKelasPassword" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Verifikasi Admin</h3>
    <input type="password" id="inputPasswordTambahKelas" placeholder="Password Admin" />
    <button onclick="verifikasiAdminTambahKelas()">Lanjut</button>
    <button onclick="tutupModal('modalTambahKelasPassword')">Batal</button>
    <p id="statusPasswordTambahKelas" style="color:red;"></p>
  </div>
</div>


    <div id="modalFormTambahKelas" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Tambah Kelas Baru</h3>
    <p>Kelas yang sudah ada:</p>
    <ul id="listKelasTersedia"></ul>
    <input type="number" id="inputNomorKelasBaruTambah" placeholder="Contoh: 7" />
    <button onclick="submitTambahKelasBaru()">Buat</button>
    <button onclick="tutupModal('modalFormTambahKelas')">Close</button>
    <p id="statusTambahKelasBaru" style="color:red;"></p>
  </div>
</div>

    

<!-- Modal Validasi Admin -->
<div id="modalAdmin" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Masukkan Password Admin</h3>
    <input type="password" id="adminPasswordInput" placeholder="Password Admin">
    <button onclick="cekPasswordAdmin()">Lanjut</button>
    <button onclick="tutupModal('modalAdmin')">Batal</button>
    <p id="adminError" style="color:red;"></p>
  </div>
</div>

<!-- Modal Form Daftar Akun -->
<div id="modalDaftar" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Daftar User Kelas</h3>
    <label>Username: <input type="text" id="newUsername"></label><br>
    <label>Password: <input type="password" id="newPassword"></label>
    <br></br>
    <label><input type="checkbox" onclick="toggleLihatPassword()"> Lihat Password</label><br><br>

    <div id="kelasCheckboxContainer">üîÑ Memuat daftar kelas...</div><br>

    <button onclick="buatAkunBaru()">Create Account</button>
    <button onclick="tutupModal('modalDaftar')">Close</button>
    <p id="daftarError" style="color:red;"></p>
    <p id="daftarSuccess" style="color:green;"></p>
  </div>
</div>


    <!-- Overlay Ganti Password -->
<div id="change-password-overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:8px; width:300px; position:relative;">
    <h3 style="margin-top:0;">Ganti Password</h3>
    <input type="text" id="change-username" placeholder="Username" required style="width:80%; margin-bottom:8px;" />
    <input type="password" id="old-password" placeholder="Password Lama" required style="width:80%; margin-bottom:8px;" />
<input type="password" id="new-password" placeholder="Password Baru" required style="width:80%; margin-bottom:8px;" />

<label style="display:block; margin-bottom:10px;">
  <input type="checkbox" onclick="togglePasswordVisibility()"> Lihat Password
</label>
    <button id="save-password-btn" type="button" onclick="submitPasswordChange()" style="width:90%;">Simpan</button>
    <p id="change-password-msg" style="color:red; margin-top:10px;"></p>
    <button onclick="toggleChangePassword()" style="position:absolute; top:5px; right:10px;">‚úñ</button>
  </div>
</div>

    <p id="login-error" style="color: red; display: none;">Username atau password salah!</p>
    
  </div>
</div>
  
    <!-- Dashboard -->
    <div id="dashboard-card" class="card" style="display: none;">
      <h1>Mutaba'ah Hafalan Santri</h1>
      <h2>Selamat datang, <span id="namaUser"></span>!</h2>

      <div class="dashboard-header">
  <div class="dashboard-header-row">
    <label for="kelas">Pilih Kelas:</label>
    <select id="kelas"></select>

    <label for="tanggal">Tanggal:</label>
    <input type="date" id="tanggal" />
  </div>
</div>

      <table id="santri-table">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Absensi</th>
            <th>Setoran Dari</th>
            <th>Setoran Sampai</th>
            <th>Terbaca</th>
            <th>Total Juz</th>
            <th>Semester</th>
            <th>Nilai</th>
            <th id="totalAllJuzHeader" style="cursor:pointer; text-decoration:underline;">Capaian Target</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="bukaModalSantri()" style="margin-left:0px;">‚ûï Tambah Santri</button>
      <button onclick="bukaModalHapusSantri()" style="margin-left:0px;">üóë Hapus Santri</button>
      <div class="actions">
        <button id="save-btn">Simpan Data Mutaba'ah</button>
        <button id="download-btn">Download PDF</button>
        <label>Dari: <input type="date" id="start-date" /></label>
        <label>Sampai: <input type="date" id="end-date" /></label>
        <button class="logout-btn" id="logout-btn">Logout</button>
      </div>
    </div>
  </div>


  <div id="modalSantri" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;">
  <div style="background:#fff; width:320px; margin:100px auto; padding:20px; border-radius:10px;">
    <h2>Tambah Santri</h2>

    <label>Nama:</label><br>
    <input type="text" id="inputNama" style="width:90%; margin-bottom:10px;" />

    <label>NIS:</label><br>
    <input type="text" id="inputNis" style="width:90%; margin-bottom:10px;" />

    <label>Semester:</label><br>
    <select id="inputSemester" style="width:90%; margin-bottom:10px;">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>

    <div style="margin-top:10px; display:flex; justify-content:space-between;">
      <button onclick="simpanSantriBaru()">Simpan</button>
    <button onclick="tutupModal('modalSantri')">‚ùå Batal</button>
    </div>

    <div id="loadingTambahSantri" style="display:none; margin-top:10px; color:blue;">
      ‚è≥ Menyimpan...
    </div>
  </div>
</div>



<div id="modalHapusSantri" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;">
  <div style="background:#fff; width:350px; margin:100px auto; padding:20px; border-radius:10px;">
    <h2>Hapus Santri</h2>
    <label>Pilih Santri:</label>
    <select id="pilihSantri" style="width:100%; margin-bottom:10px;"></select>

    <div style="margin-top:10px; display:flex; justify-content:space-between;">
      <button onclick="konfirmasiHapusSantri()">üóëÔ∏è Hapus</button>
      <button onclick="tutupModal('modalHapusSantri')">‚ùå Batal</button>
    </div>
    <div id="loadingHapusSantri" style="display:none; margin-top:10px; color:red;">
      ‚è≥ Menghapus...
    </div>
  </div>
</div>
  
  
  <div id="overlay-quran" style="display:none; position:fixed; top:0; left:0;
     width:100%; height:100%; background:rgba(0,0,0,0.5);
     z-index:10000; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:8px;
       max-width:800px; max-height:80%; overflow:auto;">
       
    <h3>Ayat Al-Qur'an</h3>
    <div id="quran-text" style="white-space:pre-wrap; line-height:2.2; direction:rtl; font-size:30px;"></div>
    <hr>
    <div>
      Nilai: <span id="nilai-akhir">100</span> ‚Äî Predikat: <span id="predikat-akhir">MUMTAZ</span>
    </div>
    <br>
    
<!-- ===== AUDIO RECORDING ===== -->
<h4>Rekam Audio</h4>

<select id="encodingTypeSelect">
  <option value="wav">Waveform Audio (.wav)</option>
  <option value="mp3">MP3 (.mp3)</option>
  <option value="ogg">Ogg Vorbis (.ogg)</option>
</select>

<div id="controls" style="margin-top:10px;">
    <button id="recordButton" class="rec-btn">‚óè Record</button>
    <button id="stopButton" class="stop-btn" disabled>‚ñ† Stop</button>
</div>

<!-- Loading spinner -->
<div id="loadingIndicator" style="display:none; margin-top:10px;">
  <div class="spinner"></div>
  <span style="margin-left:10px; font-style:italic; color:#007bff;">Membuat file audio...</span>
</div>

<ul id="recordingsList"></ul>

<style>
/* Spinner CSS */
.spinner {
  border: 4px solid #f3f3f3; /* light grey */
  border-top: 4px solid #007bff; /* blue */
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
  display: inline-block;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Tombol Rekam */
.rec-btn {
    background: linear-gradient(135deg, #ff4b5c, #ff0000);
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 50px;
    padding: 10px 25px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    margin-right: 10px;
}
.rec-btn.pulsing {
    animation: pulse 1s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 0 15px rgba(255,0,0,0.6); }
    50% { transform: scale(1.08); box-shadow: 0 0 25px rgba(255,0,0,0.8); }
    100% { transform: scale(1); box-shadow: 0 0 15px rgba(255,0,0,0.6); }
}

/* Tombol Stop */
.stop-btn {
    background: linear-gradient(135deg, #555, #333);
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 50px;
    padding: 10px 25px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
}
.stop-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}
</style>

<script>
const recBtn = document.getElementById('recordButton');
const stopBtn = document.getElementById('stopButton');
const loadingIndicator = document.getElementById('loadingIndicator');

let recording = false;

// Tombol Record
recBtn.addEventListener('click', () => {
    recording = true;
    recBtn.classList.add('pulsing');
    recBtn.disabled = true;
    stopBtn.disabled = false;
});

// Tombol Stop
stopBtn.addEventListener('click', () => {
    recording = false;
    recBtn.classList.remove('pulsing');
    recBtn.disabled = false;
    stopBtn.disabled = true;

    // tampilkan spinner
    loadingIndicator.style.display = "flex";
    loadingIndicator.style.alignItems = "center";

    if (recorder) {
        recorder.onComplete = function(recorderInstance, blob) {
            // hide spinner saat blob siap
            loadingIndicator.style.display = "none";
            // panggil preview + upload
            createDownloadLink(blob, recorderInstance.encoding);
        };
        recorder.finishRecording();
    }
});
</script>





<!-- Info format (opsional) -->
<div id="formats" style="margin-top:10px;"></div>

<ol id="recordingsList"></ol>

<!-- ===== CSS Tombol + Indikator Kedap-kedip ===== -->
<style>
/* Tombol Record */
.rec-btn {
    background: linear-gradient(135deg, #ff4b5c, #ff0000);
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 50px;
    padding: 10px 25px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
    margin-right: 10px;
}

.rec-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255,0,0,0.6);
}

/* Tombol Stop */
.stop-btn {
    background: linear-gradient(135deg, #555, #333);
    color: white;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 50px;
    padding: 10px 25px;
    cursor: pointer;
    transition: transform 0.1s, box-shadow 0.1s;
}

.stop-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

/* Indikator REC */
#recordingIndicator {
    display: none;
    color: red;
    font-weight: bold;
    margin-left: 15px;
    animation: blink 1s infinite;
}

/* Animasi kedap-kedip */
@keyframes blink {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
}
</style>

    <!-- ===== BUTTON ===== -->
    <button id="btn-nilai-100">Nilai 100</button>
    <button id="save-btn-modal">Simpan Data Mutaba'ah</button>
    <button onclick="document.getElementById('overlay-quran').style.display='none'">Tutup</button>
  </div>
</div>
<!-- inserting these scripts at the end to be able to use all the elements in the DOM -->
	<script src="js/WebAudioRecorder.min.js"></script>
	<script src="js/app.js"></script>



<!-- Overlay Hitung Total All Juz -->
<div id="juzOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
background:rgba(0,0,0,0.5); z-index:999; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:8px; min-width:300px;">
    <h3>Hitung Total All Juz</h3>
    <label>Dari: <input type="date" id="rangeDari"></label><br><br>
    <label>Sampai: <input type="date" id="rangeSampai" disabled></label><br><br>
    <button id="btnHitungTotalJuz">Hitung Total All Juz</button>
    <button onclick="document.getElementById('juzOverlay').style.display='none'">Close</button>
  </div>
</div>

  
 <script>
  // === Deklarasi elemen ===
